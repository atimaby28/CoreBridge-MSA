# CoreBridge 아키텍처

## 전체 시스템 구성도

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Client Layer                                   │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    Vue 3 + TypeScript + Tailwind                      │  │
│  │                         (localhost:5173)                              │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Backend Services (Spring Boot MSA)                     │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐               │
│  │  user   │ │jobpost- │ │ applica │ │ process │ │schedule │               │
│  │  :8001  │ │ing:8002 │ │tion:8003│ │  :8004  │ │  :8005  │               │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘               │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐               │
│  │ notifi- │ │ resume  │ │  like   │ │  view   │ │  read   │               │
│  │cation   │ │  :8007  │ │  :8008  │ │  :8009  │ │  :8010  │               │
│  │  :8006  │ └─────────┘ └─────────┘ └─────────┘ └─────────┘               │
│  └─────────┘ ┌─────────┐ ┌─────────┐ ┌─────────┐                           │
│              │   hot   │ │ comment │ │  audit  │                           │
│              │  :8011  │ │  :8012  │ │  :8013  │                           │
│              └─────────┘ └─────────┘ └─────────┘                           │
└─────────────────────────────────────────────────────────────────────────────┘
          │                     │                            │
          ▼                     ▼                            ▼
┌──────────────────┐  ┌──────────────────┐  ┌──────────────────────────────┐
│    PostgreSQL    │  │   Redis Stack    │  │        AI Pipeline           │
│   (Main DB)      │  │(Pub/Sub, Vector) │  │   (FastAPI + Ollama + n8n)   │
└──────────────────┘  └──────────────────┘  └──────────────────────────────┘
```

## 서비스별 역할

### 핵심 비즈니스 서비스

| 서비스 | 역할 | 주요 API |
|--------|------|----------|
| user | 사용자 인증/권한 | POST /login, POST /signup |
| jobposting | 채용공고 관리 | CRUD /api/v1/jobpostings |
| application | 지원서 관리 | POST /apply, GET /applications |
| process | 채용 상태관리 (State Machine) | PATCH /transition |
| schedule | 면접 일정 | CRUD /api/v1/schedules |
| notification | 실시간 알림 (SSE) | POST /notifications, GET /sse |
| resume | 이력서 관리 | CRUD /api/v1/resumes |

### 부가 서비스

| 서비스 | 역할 |
|--------|------|
| like | 공고 좋아요 |
| view | 조회수 카운팅 |
| read | 공고 상세 (Aggregator) |
| hot | 인기 공고 집계 |
| comment | 댓글 |
| audit | 감사 로그 |

## 공통 모듈 (common)

```
common/
├── audit/           # 감사 로그 AOP 필터
├── response/        # 표준 응답 포맷 (BaseResponse)
├── snowflake/       # 분산 ID 생성기
└── domain/          # BaseTimeEntity
```

## AI 파이프라인

```
┌─────────────────────────────────────────────────────────────────┐
│                      n8n Workflow Engine                        │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐   │
│  │Webhook  │→│ Parse   │→│ Analyze │→│ Embed   │→│ Match   │   │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘   │
│                              │             │           │        │
└──────────────────────────────┼─────────────┼───────────┼────────┘
                               ▼             ▼           ▼
                        ┌──────────┐  ┌──────────┐ ┌──────────┐
                        │  Ollama  │  │  Embed   │ │  Redis   │
                        │   LLM    │  │  Model   │ │  Vector  │
                        └──────────┘  └──────────┘ └──────────┘
```

### 파이프라인 단계

1. **Webhook**: 이력서 제출 이벤트 수신
2. **Parse**: 이력서 텍스트 추출/전처리
3. **Analyze**: LLM으로 요약 생성 + 스킬 추출
4. **Embed**: 문장 임베딩 (벡터화)
5. **Match**: Redis Vector Search로 JD 매칭
6. **Score**: 종합 점수 산출
7. **Callback**: Spring Boot로 결과 전달

## 실시간 알림 시스템

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Process   │────▶│ Redis       │────▶│ Notification│
│   Service   │     │ Pub/Sub     │     │   Service   │
└─────────────┘     └─────────────┘     └─────────────┘
                                              │
                                              ▼ SSE
                                        ┌─────────────┐
                                        │   Browser   │
                                        └─────────────┘
```

- **Redis Pub/Sub**: 다중 서버 환경에서 메시지 브로드캐스트
- **SSE**: 서버→클라이언트 단방향 실시간 전송
- **Spring Batch**: 실패 알림 재전송 (5분마다)

## 데이터 흐름

### 지원 프로세스
```
1. User → Application 서비스: 지원 생성
2. Application → Process 서비스: 채용 프로세스 시작
3. Application → AI Pipeline: 이력서 분석 요청
4. AI → Application: 분석 결과 + 매칭 점수 반환
5. Company → Process 서비스: 상태 전이
6. Process → Notification 서비스: 상태 변경 알림
7. User: 실시간 알림 수신
```

### 감사 로그
```
모든 API 요청 → AuditLoggingFilter → Audit 서비스 → PostgreSQL
```
